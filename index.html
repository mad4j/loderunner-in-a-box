<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Lode Runner</title>

    <style>
        html,
        body {
            height: 100%;
        }

        #dos {
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- js-dos style sheet -->
    <link rel="stylesheet" href="./js-dos.css">

    <!-- js-dos -->
    <script src="./js-dos.js"></script>

    <!-- hammer.js -->
    <script src="./hammer.min.js"></script>
</head>

<body>

    <div id="dos" style="width: 100%; height: 100%"></div>

    <script type="text/javascript">

        Dos(document.getElementById("dos"), {
            url: "./lr.jsdos",
            pathPrefix: "./emulators/",
            theme: "dark",
            kiosk: false,
            autoStart: true,
            noCursor: true,
            noCloud: true,
            noNetworking: true,
        });

        const keybEnter = {
            char: '\n',
            key: "Enter",
            code: "Enter",
            keyCode: 13
        };

        const keybEsc = {
            char: '\0',
            key: "Esc",
            code: "Esc",
            keyCode: 27
        };

        const keybNum2 = {
            char: '2',
            key: "2",
            code: "Numpad2",
            keyCode: 98
        };

        const keybNum4 = {
            char: '4',
            key: "4",
            code: "Numpad4",
            keyCode: 100
        };

        const keybNum5 = {
            char: '5',
            key: "5",
            code: "Numpad5",
            keyCode: 101
        };

        const keybNum6 = {
            bubbles: true,
            cancelable: true,
            char: '6',
            key: "6",
            code: "Numpad6",
            keyCode: 102
        };

        const keybNum7 = {
            char: '7',
            key: "7",
            code: "Numpad7",
            keyCode: 103
        };

        const keybNum8 = {
            char: '8',
            key: "8",
            code: "Numpad8",
            keyCode: 104
        };

        const keybNum9 = {
            char: '9',
            key: "9",
            code: "Numpad9",
            keyCode: 105
        };

        var el = document.getElementById("dos");
        var hm = new Hammer.Manager(el);

        hm.add(new Hammer.Tap({ event: "singletap", taps: 1 }));
        hm.on("singletap", function (e) {

            var centerX = el.offsetLeft + el.offsetWidth / 2.0;
            var centerY = el.offsetTop + el.offsetHeight / 2.0;

            var x = e.center.x - centerX;
            var y = e.center.y - centerY;
            var r = Math.min(el.offsetWidth, el.offsetHeight) / 2.0;

            var k = keybEnter;

            if (x * x + y * y < r * r) {
                k = keybEnter;
            } else if (x < 0) {
                k = keybNum7;
            } else {
                k = keybNum9;
            }

            document.dispatchEvent(new KeyboardEvent("keydown", k));
            document.dispatchEvent(new KeyboardEvent("keyup", k));
        });

        hm.add(new Hammer.Pan({ event: "pan" }));
        hm.get("pan").set({ direction: Hammer.DIRECTION_ALL });

        var lastPan = "none";

        hm.on("panstart panend pancancel", function (e) {
            lastPan = "none";
        });

        hm.on("panleft panright panup pandown", function (e) {

            if (e.type == lastPan) {
                return;
            }

            lastPan = e.type;

            var k = keybNum5;
            switch (e.type) {
                case "panleft":
                    k = keybNum4;
                    break;
                case "panright":
                    k = keybNum6;
                    break;
                case "panup":
                    k = keybNum8;
                    break;
                case "pandown":
                    k = keybNum2;
                    break;
                default:
                    k = keybNum5;
                    break;
            }

            document.dispatchEvent(new KeyboardEvent("keydown", k));
            document.dispatchEvent(new KeyboardEvent("keyup", k));
        });

    </script>
</body>

</html>